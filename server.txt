
sudo -s

# upgrade system
apt-get update
apt-get -y upgrade
apt-get -y install python-software-properties language-pack-en curl git-core build-essential

# add repository
add-apt-repository -y ppa:nginx/stable
add-apt-repository -y ppa:chris-lea/node.js
apt-get update

# nginx
apt-get -y install nginx

# extras for rubygems and rails
apt-get -y install zlib1g-dev libssl-dev

# readline dev
apt-get -y install libreadline-gplv2-dev

# reboot system
reboot

sudo -s

# rbenv
curl -L https://raw.github.com/fesplugas/rbenv-installer/master/bin/rbenv-installer | bash
wget https://raw.github.com/davidebettio/rails3-nginx-unicorn/master/.bash_profile
#


# rbenv installer (https://github.com/fesplugas/rbenv-installer)
git clone git://github.com/sstephenson/rbenv.git .rbenv
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bash_profile
echo 'eval "$(rbenv init -)"' >> ~/.bash_profile
exec $SHELL

cd
wget http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p194.tar.gz
tar -xzf ruby-1.9.3-p194.tar.gz
rm ruby-1.9.3-p194.tar.gz
cd ruby-1.9.3-p194
./configure --prefix=$HOME/.rbenv/versions/1.9.3-p194
make
make install
cd
rm -rf ruby-1.9.3-p194

mkdir -p ~/.rbenv/plugins
cd ~/.rbenv/plugins
git clone git://github.com/sstephenson/ruby-build.git
exit
#re-enter
rbenv install 1.9.3-p194
rbenv global 1.9.3-p194
gem install bundler --no-ri --no-rdoc
rbenv rehash

# gem
cd
wget .gemrc

# rails
cd
gem install rails

# nodejs
sudo apt-get update
sudo apt-get install nodejs npm

# backup original nginx.conf and mime.types
sudo mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf.orig
sudo mv /etc/nginx/mime.types /etc/nginx/mime.types.orig

# config nginx from https://github.com/h5bp/server-configs
cd /etc/nginx
wget nginx.conf

# enable example site
cd /etc/nginx/sites-available
wget example.com
cd /etc/nginx
sudo ln -s /etc/nginx/sites-available/example.com sites-enabled/example.com
cd
mkdir www
cd www
sudo apt-get install libsqlite3-dev
rails new example
cd example
echo "gem 'unicorn'" >> Gemfile
echo "gem 'capistrano'" >> Gemfile
bundle

# wget extra conf
sudo mv /etc/nginx/conf.d /etc/nginx/conf
cd /etc/nginx/conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/cache-busting.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/cross-domain-ajax.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/cross-domain-fonts.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/expires.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/h5bp.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/no-transform.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/protect-system-files.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/x-ua-compatible.conf

# remove default nginx site
sudo rm /etc/nginx/sites-enabled/default

# restart nginx
sudo service nginx restart



