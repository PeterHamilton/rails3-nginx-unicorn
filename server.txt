# enter sudo shell
sudo -s

# upgrade system
apt-get update
apt-get -y upgrade
apt-get -y install python-software-properties language-pack-en curl git-core build-essential

# set language for system
echo "LC_ALL=en_US.utf8" >> /etc/environment

# add repository
add-apt-repository -y ppa:nginx/stable
add-apt-repository -y ppa:chris-lea/node.js
apt-get update

# nginx
apt-get -y install nginx

# nodejs
apt-get -y install nodejs npm

# reboot system
reboot

# now stay in the deploy user

# rbenv
curl -L https://raw.github.com/fesplugas/rbenv-installer/master/bin/rbenv-installer | bash
wget -O - https://raw.github.com/davidebettio/rails3-nginx-unicorn/master/.profile >> ~/.profile

# reload bash and continue with rbenv
rbenv bootstrap-ubuntu-12-04
rbenv install 1.9.3-p194
rbenv global 1.9.3-p194
rbenv rehash

# gem
wget -O ~/.gemrc https://raw.github.com/davidebettio/rails3-nginx-unicorn/master/.gemrc

# reload bash and install rubygems
gem install bundler --no-ri --no-rdoc

# rails
gem install rails

# enter sudo shell
sudo -s

# backup original nginx.conf and mime.types
mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf.orig
mv /etc/nginx/mime.types /etc/nginx/mime.types.orig

# config nginx from https://github.com/h5bp/server-configs
cd /etc/nginx
wget nginx.conf

# enable example site
cd /etc/nginx/sites-available
wget example.com
cd /etc/nginx
sudo ln -s /etc/nginx/sites-available/example.com sites-enabled/example.com
cd
mkdir www
cd www
sudo apt-get install libsqlite3-dev
rails new example
cd example
echo "gem 'unicorn'" >> Gemfile
echo "gem 'capistrano'" >> Gemfile
bundle

# wget extra conf
sudo mv /etc/nginx/conf.d /etc/nginx/conf
cd /etc/nginx/conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/cache-busting.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/cross-domain-ajax.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/cross-domain-fonts.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/expires.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/h5bp.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/no-transform.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/protect-system-files.conf
sudo wget https://raw.github.com/h5bp/server-configs/master/nginx/conf/x-ua-compatible.conf

# remove default nginx site
sudo rm /etc/nginx/sites-enabled/default

# restart nginx
sudo service nginx restart



